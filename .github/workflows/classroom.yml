    - name: Run tests and generate report
      id: run-tests
      run: |
        # Запускаем тесты, игнорируя ошибки (чтобы workflow не упал раньше времени)
        pytest --json-report --json-report-file=report.json homework01 || true
        
        # Считаем количество пройденных и общее количество тестов
        PASSED=$(python3 -c "import json; r=json.load(open('report.json')); print(r['summary'].get('passed', 0))")
        TOTAL=$(python3 -c "import json; r=json.load(open('report.json')); print(r['summary'].get('total', 0))")
        
        echo "passed=$PASSED" >> $GITHUB_OUTPUT
        echo "total=$TOTAL" >> $GITHUB_OUTPUT

    - name: Autograding Reporter
      uses: education/autograding-grading-reporter@v1
      env:
        # Здесь мы вручную создаем структуру JSON, которую ждет Classroom
        # Студент получит столько баллов, сколько тестов прошел
        UNIT-TESTS_RESULTS: >-
          {"tests": [
            {
              "name": "Unit Tests",
              "setup": "pytest",
              "run": "python -m unittest",
              "input": "",
              "output": "",
              "comparison": "included",
              "timeout": 10,
              "points": ${{ steps.run-tests.outputs.total }},
              "score": ${{ steps.run-tests.outputs.passed }}
            }
          ]}
      with:
        runners: UNIT-TESTS
